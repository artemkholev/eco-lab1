# EcoLab2 - Компонентная система калькулятора

## Архитектура системы

Система построена вокруг трёх основных интерфейсов:
- **IEcoLab1** - базовый интерфейс калькулятора
- **IEcoCalculatorX** - расширенный интерфейс вычислений
- **IEcoCalculatorY** - альтернативный интерфейс вычислений

Каждый компонент реализует все три интерфейса и поддерживает бесшовную навигацию между ними с использованием паттерна QueryInterface.

## Результаты тестирования

### Проверка базовых арифметических операций

Реализация успешно выполняет стандартные арифметические операции:

| Операция | Выражение | Результат | Статус |
|----------|-----------|-----------|--------|
| Сложение | 7 + 18 | 25 | Пройдено |
| Вычитание | 42 - 17 | 25 | Пройдено |
| Умножение | 6 × 7 | 42 | Пройдено |
| Деление | 56 ÷ 8 | 7 | Пройдено |

### Тестирование навигации между интерфейсами

Механизм QueryInterface обеспечивает динамическое приведение типов между всеми реализованными интерфейсами. Граф интерфейсов полностью связан:

```
IEcoLab1 ──────┐
    │          │
    ↓          ↓
IEcoCalculatorX ⟷ IEcoCalculatorY
```

**Результаты верификации:**

Все 9 переходов через QueryInterface выполнены успешно:

- IEcoLab1 → IEcoCalculatorX (успешно)
- IEcoLab1 → IEcoCalculatorY (успешно)
- IEcoLab1 → IEcoLab1 (самозапрос, успешно)
- IEcoCalculatorX → IEcoCalculatorY (успешно)
- IEcoCalculatorX → IEcoLab1 (успешно)
- IEcoCalculatorX → IEcoCalculatorX (самозапрос, успешно)
- IEcoCalculatorY → IEcoCalculatorX (успешно)
- IEcoCalculatorY → IEcoCalculatorY (самозапрос, успешно)
- IEcoCalculatorY → IEcoLab1 (успешно)

## Детали реализации

### Ключевые особенности

- **Поддержка множественных интерфейсов**: каждый компонент одновременно реализует несколько интерфейсов
- **Динамическое приведение интерфейсов**: QueryInterface обеспечивает обнаружение интерфейсов во время выполнения
- **Подсчёт ссылок**: корректное управление памятью через методы AddRef/Release
- **COM-подобная архитектура**: следует принципам компонентной объектной модели

### Взаимосвязи интерфейсов

Система поддерживает идентичность интерфейсов - многократный запрос одного и того же интерфейса возвращает один и тот же указатель, обеспечивая поведение singleton для каждого типа интерфейса внутри экземпляра компонента.

## Использование

Компонент калькулятора может быть создан и запрошен для любого из поддерживаемых интерфейсов:

```c
// Создание экземпляра компонента
IEcoLab1* pLab1 = NULL;
CreateComponent(&pLab1);

// Навигация к другим интерфейсам при необходимости
IEcoCalculatorX* pCalcX = NULL;
pLab1->QueryInterface(IID_IEcoCalculatorX, (void**)&pCalcX);

// Выполнение вычислений
int32_t result = pCalcX->Add(7, 18);  // result = 25

// Освобождение ресурсов
pCalcX->Release();
pLab1->Release();
```

## Технический анализ

### Управление памятью

Реализация корректно обрабатывает подсчёт ссылок для всех интерфейсов. Каждый вызов QueryInterface увеличивает счётчик ссылок, и компонент уничтожается только после освобождения всех ссылок.

### Симметрия интерфейсов

Реализация QueryInterface поддерживает симметрию - если интерфейс A может быть получен из интерфейса B, то интерфейс B может быть получен из интерфейса A. Такая двунаправленная навигация является критически важной для COM-подобных систем.
